<%+header%>
<style>

/* Better responsive design */
@media (max-width: 768px) {
  .wifi-grid { grid-template-columns: 1fr; gap: 15px; margin: 15px 0; }
  .wifi-card { padding: 15px; }
  .wifi-icon { font-size: 2em; }
}

.wifi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px;margin:20px 0}
.wifi-card{background:#fff;border:1px solid #ddd;border-radius:8px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1);transition:all 0.2s;text-decoration:none;color:inherit;display:block}
.wifi-card:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,0.15);text-decoration:none;color:inherit}
.wifi-icon{font-size:2.5em;text-align:center;margin-bottom:15px}
.wifi-name{font-size:1.3em;font-weight:bold;margin-bottom:8px;text-align:center}
.wifi-info{text-align:center;color:#666;margin-bottom:15px}
.wifi-btn{background:#0969da;color:#fff;padding:10px 20px;border-radius:6px;text-align:center;font-weight:500}
.loading-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px;margin:20px 0}
.loading-card{background:#f6f8fa;border-radius:8px;padding:40px;animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
[data-darkmode="true"] .wifi-card{background:#1c2128;border-color:#30363d;color:#f0f6fc}
[data-darkmode="true"] .wifi-info{color:#8b949e}

/* Loading animation improvements */
.loading-card:nth-child(1) { animation-delay: 0s; }
.loading-card:nth-child(2) { animation-delay: 0.2s; }
.loading-card:nth-child(3) { animation-delay: 0.4s; }

/* Better button styling */
.wifi-btn:hover { background: #0860ca; transform: translateY(-1px); }
.wifi-btn:active { transform: translateY(0); }
</style>

<h2>WiFi QR Codes</h2>
<div class="cbi-map">
<fieldset class="cbi-section">
<div id="list">
<div class="loading-grid">
<div class="loading-card"></div>
<div class="loading-card"></div>
<div class="loading-card"></div>
</div>
</div>
</fieldset>
</div>

<script>
(function(){
  const listEl = document.getElementById('list');
  
  function loadNetworks() {
    fetch('/cgi-bin/luci/admin/network/wifi_qr/data')
      .then(res => res.json())
      .then(nets => {
        if (!nets || !nets.length) { 
          listEl.innerHTML = '<div class="alert-message warning">No WiFi networks found. Make sure your device has active AP interfaces.</div>'; 
          return;
        }
        
        const unique = {};
        nets.forEach(n => {
          const key = n.ssid + '|' + (n.key || '');
          if (!unique[key]) unique[key] = n;
        });
        
        const grid = document.createElement('div');
        grid.className = 'wifi-grid';
        
        Object.values(unique).forEach(n => {
          const card = document.createElement('a');
          card.className = 'wifi-card';
          card.href = '/cgi-bin/luci/admin/network/wifi_qr/network?ssid=' + encodeURIComponent(n.ssid);
          
          const auth = n.encryption && (n.encryption.match(/psk/) || n.encryption.match(/sae/)) ? 'WPA' : 
                       n.encryption && n.encryption.match(/wep/) ? 'WEP' : 'Open';
          const icon = n.key ? 'ðŸ”’' : 'ðŸ“¶';
          
          card.innerHTML = 
            '<div class="wifi-icon">' + icon + '</div>' +
            '<div class="wifi-name">' + n.ssid + '</div>' +
            '<div class="wifi-info">' + auth + (n.key ? ' â€¢ Protected' : ' â€¢ Open Network') + '</div>' +
            '<div class="wifi-btn">Generate QR Code</div>';
          grid.appendChild(card);
        });
        
        listEl.innerHTML = '';
        listEl.appendChild(grid);
      })
      .catch(e => { 
        listEl.innerHTML = '<div class="alert-message error">Failed to load networks: ' + e.message + '<br><button class="btn cbi-button" onclick="location.reload()">Retry</button></div>';
      });
  }
  
  loadNetworks();
})();
</script>
<%+footer%>
<script type="text/javascript">L.require('menu-bootstrap')</script>